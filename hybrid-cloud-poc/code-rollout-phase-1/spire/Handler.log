=== RUN   TestGenerateStubbedSovereignAttestation_FeatureFlagDisabled
--- PASS: TestGenerateStubbedSovereignAttestation_FeatureFlagDisabled (0.00s)
=== RUN   TestGenerateStubbedSovereignAttestation_FeatureFlagEnabled
time="2025-11-05T02:19:38+01:00" level=info msg="Unified-Identity - Phase 1: Generating stubbed sovereign attestation"
time="2025-11-05T02:19:38+01:00" level=info msg="Unified-Identity - Phase 1: Generated stubbed sovereign attestation" has_app_key=true has_app_key_cert=true has_nonce=true has_tpm_quote=true workload_code_hash=
--- PASS: TestGenerateStubbedSovereignAttestation_FeatureFlagEnabled (0.00s)
=== RUN   TestValidateSovereignAttestation
=== RUN   TestValidateSovereignAttestation/nil_attestation
=== RUN   TestValidateSovereignAttestation/missing_tpm_quote
=== RUN   TestValidateSovereignAttestation/invalid_base64_tpm_quote
=== RUN   TestValidateSovereignAttestation/missing_nonce
=== RUN   TestValidateSovereignAttestation/missing_app_key_public
=== RUN   TestValidateSovereignAttestation/valid_attestation
--- PASS: TestValidateSovereignAttestation (0.00s)
    --- PASS: TestValidateSovereignAttestation/nil_attestation (0.00s)
    --- PASS: TestValidateSovereignAttestation/missing_tpm_quote (0.00s)
    --- PASS: TestValidateSovereignAttestation/invalid_base64_tpm_quote (0.00s)
    --- PASS: TestValidateSovereignAttestation/missing_nonce (0.00s)
    --- PASS: TestValidateSovereignAttestation/missing_app_key_public (0.00s)
    --- PASS: TestValidateSovereignAttestation/valid_attestation (0.00s)
=== RUN   TestProcessSovereignAttestation
=== RUN   TestProcessSovereignAttestation/nil_request
=== RUN   TestProcessSovereignAttestation/request_with_valid_sovereign_attestation
=== RUN   TestProcessSovereignAttestation/request_with_invalid_sovereign_attestation
time="2025-11-05T02:19:38+01:00" level=error msg="Unified-Identity - Phase 1: Invalid sovereign attestation in request" error="tpm_signed_attestation is required"
--- PASS: TestProcessSovereignAttestation (0.00s)
    --- PASS: TestProcessSovereignAttestation/nil_request (0.00s)
    --- PASS: TestProcessSovereignAttestation/request_with_valid_sovereign_attestation (0.00s)
    --- PASS: TestProcessSovereignAttestation/request_with_invalid_sovereign_attestation (0.00s)
=== RUN   TestFetchX509SVID
=== RUN   TestFetchX509SVID/no_identity_issued
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509SVID/no_identity_issued,_with_logged_selectors
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509SVID/no_identity_issued_(healthcheck)
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509SVID/attest_error
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509SVID/subscribe_to_cache_changes_error
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509SVID/with_identity_and_federated_bundles
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509SVID/with_two_identities
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509SVID/identities_with_duplicated_hints
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
--- PASS: TestFetchX509SVID (0.12s)
    --- PASS: TestFetchX509SVID/no_identity_issued (0.01s)
    --- PASS: TestFetchX509SVID/no_identity_issued,_with_logged_selectors (0.00s)
    --- PASS: TestFetchX509SVID/no_identity_issued_(healthcheck) (0.00s)
    --- PASS: TestFetchX509SVID/attest_error (0.00s)
    --- PASS: TestFetchX509SVID/subscribe_to_cache_changes_error (0.00s)
    --- PASS: TestFetchX509SVID/with_identity_and_federated_bundles (0.02s)
    --- PASS: TestFetchX509SVID/with_two_identities (0.03s)
    --- PASS: TestFetchX509SVID/identities_with_duplicated_hints (0.04s)
=== RUN   TestFetchX509Bundles
=== RUN   TestFetchX509Bundles/no_identity_issued
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509Bundles/attest_error
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509Bundles/subscribe_to_cache_changes_error
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509Bundles/cache_update_unexpectedly_missing_bundle
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509Bundles/success
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchX509Bundles/when_allowed_to_fetch_without_identity
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
--- PASS: TestFetchX509Bundles (0.03s)
    --- PASS: TestFetchX509Bundles/no_identity_issued (0.00s)
    --- PASS: TestFetchX509Bundles/attest_error (0.00s)
    --- PASS: TestFetchX509Bundles/subscribe_to_cache_changes_error (0.00s)
    --- PASS: TestFetchX509Bundles/cache_update_unexpectedly_missing_bundle (0.00s)
    --- PASS: TestFetchX509Bundles/success (0.01s)
    --- PASS: TestFetchX509Bundles/when_allowed_to_fetch_without_identity (0.00s)
=== RUN   TestFetchX509Bundles_MultipleUpdates
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
--- PASS: TestFetchX509Bundles_MultipleUpdates (0.01s)
=== RUN   TestFetchX509Bundles_SpuriousUpdates
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
--- PASS: TestFetchX509Bundles_SpuriousUpdates (0.01s)
=== RUN   TestFetchJWTSVID
=== RUN   TestFetchJWTSVID/missing_required_audience
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTSVID/spiffe_id_set,_but_not_a_valid_SPIFFE_ID
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTSVID/no_identity_issued
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTSVID/no_identity_issued,_with_selectors
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTSVID/identity_found_but_unexpected_SPIFFE_ID
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTSVID/attest_error
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTSVID/fetch_error
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTSVID/success_all
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTSVID/success_specific
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTSVID/identities_with_duplicated_hints
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
--- PASS: TestFetchJWTSVID (0.04s)
    --- PASS: TestFetchJWTSVID/missing_required_audience (0.00s)
    --- PASS: TestFetchJWTSVID/spiffe_id_set,_but_not_a_valid_SPIFFE_ID (0.00s)
    --- PASS: TestFetchJWTSVID/no_identity_issued (0.00s)
    --- PASS: TestFetchJWTSVID/no_identity_issued,_with_selectors (0.00s)
    --- PASS: TestFetchJWTSVID/identity_found_but_unexpected_SPIFFE_ID (0.00s)
    --- PASS: TestFetchJWTSVID/attest_error (0.00s)
    --- PASS: TestFetchJWTSVID/fetch_error (0.00s)
    --- PASS: TestFetchJWTSVID/success_all (0.00s)
    --- PASS: TestFetchJWTSVID/success_specific (0.00s)
    --- PASS: TestFetchJWTSVID/identities_with_duplicated_hints (0.01s)
=== RUN   TestFetchJWTBundles
=== RUN   TestFetchJWTBundles/no_identity_issued
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTBundles/attest_error
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTBundles/subscribe_to_cache_changes_error
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTBundles/cache_update_unexpectedly_missing_bundle
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTBundles/success
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTBundles/when_allowed_to_fetch_without_identity
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestFetchJWTBundles/federated_bundle_with_JWKS_empty_keys_array
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
--- PASS: TestFetchJWTBundles (0.03s)
    --- PASS: TestFetchJWTBundles/no_identity_issued (0.00s)
    --- PASS: TestFetchJWTBundles/attest_error (0.00s)
    --- PASS: TestFetchJWTBundles/subscribe_to_cache_changes_error (0.00s)
    --- PASS: TestFetchJWTBundles/cache_update_unexpectedly_missing_bundle (0.00s)
    --- PASS: TestFetchJWTBundles/success (0.01s)
    --- PASS: TestFetchJWTBundles/when_allowed_to_fetch_without_identity (0.01s)
    --- PASS: TestFetchJWTBundles/federated_bundle_with_JWKS_empty_keys_array (0.00s)
=== RUN   TestFetchJWTBundles_MultipleUpdates
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
--- PASS: TestFetchJWTBundles_MultipleUpdates (0.01s)
=== RUN   TestFetchJWTBundles_SpuriousUpdates
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
--- PASS: TestFetchJWTBundles_SpuriousUpdates (0.01s)
=== RUN   TestValidateJWTSVID
=== RUN   TestValidateJWTSVID/missing_required_audience
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestValidateJWTSVID/missing_required_svid
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestValidateJWTSVID/malformed_svid
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestValidateJWTSVID/attest_error
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestValidateJWTSVID/success
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestValidateJWTSVID/success_with_federated_SVID
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestValidateJWTSVID/success_with_federated_SVID_with_allowed_foreign_claims
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
=== RUN   TestValidateJWTSVID/failure_with_federated_SVID
    server.go:126: Gracefully stopping gRPC server
    server.go:128: Server stopped
    server.go:130: Server serve returned <nil>
    server.go:122: Waiting for handlers to drain
    server.go:124: Handlers drained
--- PASS: TestValidateJWTSVID (0.03s)
    --- PASS: TestValidateJWTSVID/missing_required_audience (0.00s)
    --- PASS: TestValidateJWTSVID/missing_required_svid (0.00s)
    --- PASS: TestValidateJWTSVID/malformed_svid (0.00s)
    --- PASS: TestValidateJWTSVID/attest_error (0.00s)
    --- PASS: TestValidateJWTSVID/success (0.01s)
    --- PASS: TestValidateJWTSVID/success_with_federated_SVID (0.00s)
    --- PASS: TestValidateJWTSVID/success_with_federated_SVID_with_allowed_foreign_claims (0.00s)
    --- PASS: TestValidateJWTSVID/failure_with_federated_SVID (0.00s)
PASS
ok  	github.com/spiffe/spire/pkg/agent/endpoints/workload	(cached)
