INFO:__main__:[2m2025-10-31T03:40:38.107878Z[0m [[32m[1minfo     [0m] [1mGateway logging configuration [0m [[34m[1m__main__[0m] [36mdebug_all[0m=[35mFalse[0m [36mdebug_gateway[0m=[35mFalse[0m [36mlog_level[0m=[35mINFO[0m
INFO:__main__:[2m2025-10-31T03:40:38.118585Z[0m [[32m[1minfo     [0m] [1mSkipping OpenTelemetry metrics setup for compatibility[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-10-31T03:40:38.120040Z[0m [[32m[1minfo     [0m] [1mOpenTelemetry setup completed (OTLP export disabled)[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-10-31T03:40:38.120637Z[0m [[32m[1minfo     [0m] [1mGateway allowlist loaded      [0m [[34m[1m__main__[0m] [36magent_count[0m=[35m2[0m [36mpath[0m=[35mgateway/allowed_agents.json[0m
INFO:__main__:[2m2025-10-31T03:40:38.120773Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_VALIDATION_CONFIG[0m [[34m[1m__main__[0m] [36menv_var_value[0m=[35mtrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:38.120860Z[0m [[32m[1minfo     [0m] [1mGateway allowlist manager initialized[0m [[34m[1m__main__[0m] [36magent_count[0m=[35m2[0m [36mallowlist_path[0m=[35mgateway/allowed_agents.json[0m [36mvalidate_geolocation[0m=[35mTrue[0m [36mvalidate_public_key_hash[0m=[35mTrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:38.161775Z[0m [[32m[1minfo     [0m] [1mGenerated temporary SSL certificates[0m [[34m[1m__main__[0m] [36mcert_path[0m=[35m/tmp/tmpi4a6tkiy.pem[0m [36mkey_path[0m=[35m/tmp/tmpxsj24mzm.pem[0m
 * Serving Flask app 'app'
 * Debug mode: off
INFO:__main__:[2m2025-10-31T03:40:45.939695Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mNone[0m [36mSignature[0m=[35mNone[0m [36mSignature-Input[0m=[35mkeyid="2fcbb74343261c4f35c2f0c3b61dae3d3dadfc6bb233975f1c5b2fe60ec20b6a", created=1761882045, expires=1761882345, alg="RSA"[0m [36mWorkload-Geo-ID[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mmethod[0m=[35mGET[0m
INFO:__main__:[2m2025-10-31T03:40:45.940414Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mexpected_headers_for_endpoint[0m=[35mSignature-Input only (no geolocation)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/nonce[0m [36mquery_params[0m=[35m{'public_key_hash': '2fcbb74343261c4f35c2f0c3b61dae3d3dadfc6bb233975f1c5b2fe60ec20b6a'}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="2fcbb74343261c4f35c2f0c3b61dae3d3dadfc6bb233975f1c5b2fe60ec20b6a", created=1761882045, expires=1761882345, alg="RSA"[0m [36msignature_present[0m=[35mFalse[0m [36msignature_value[0m=[35mNone[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mFalse[0m [36mworkload_geo_id_value[0m=[35mNone[0m
INFO:__main__:[2m2025-10-31T03:40:45.941077Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/nonce[0m [36mgeolocation_header_present[0m=[35mFalse[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mFalse[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:45.941601Z[0m [[32m[1minfo     [0m] [1mSecurityManager validating nonce request - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-10-31T03:40:45.941832Z[0m [[32m[1minfo     [0m] [1m‚úÖ [GATEWAY] Nonce validation passed - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-10-31T03:40:45.973177Z[0m [[32m[1minfo     [0m] [1mNonce request proxied successfully[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-10-31T03:40:46.764298Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mapplication/json[0m [36mSignature[0m=[35m9164ce24c3c996b75f11c481bbeffdbf1aa3f8e5a30e8e354829680282c3fd748130d3bce7fe5e2591f61923646855d185f8cc7a270e2d80ea4d567ec544a4fa9fef4cb2bf93f5b4c5ab839464994fdbb96be4db8782d9b0e2b9872ced2724e97a5b2cb130b2e7fb6408b00bade6bfebdf788b95126722cddb804b4a69277ab9ffab1761ccab37fa0cda6e998def427edece46d9763e58cde9a5efd93233ddbd010f50a7868e9814a95102274fd97adbaef579b9715d0ee96e4126ef44f3b4cf109a822b53ed2796286c4cd418cd16798e64c81dc2ab4b41d0b1680c0fae8dc6561918870794ad7c684b8d2faffb6bd36bbdcefe159e5fea14ad449f09be6ce4[0m [36mSignature-Input[0m=[35mkeyid="2fcbb74343261c4f35c2f0c3b61dae3d3dadfc6bb233975f1c5b2fe60ec20b6a", created=1761882046, expires=1761882346, alg="RSA"[0m [36mWorkload-Geo-ID[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mendpoint[0m=[35m/metrics[0m [36mmethod[0m=[35mPOST[0m
INFO:__main__:[2m2025-10-31T03:40:46.764846Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mapplication/json[0m [36mendpoint[0m=[35m/metrics[0m [36mexpected_headers_for_endpoint[0m=[35mWorkload-Geo-ID + Signature-Input + Signature[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/metrics[0m [36mquery_params[0m=[35m{}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="2fcbb74343261c4f35c2f0c3b61dae3d3dadfc6bb233975f1c5b2fe60ec20b6a", created=1761882046, expires=1761882346, alg="RSA"[0m [36msignature_present[0m=[35mTrue[0m [36msignature_value[0m=[35m9164ce24c3c996b75f11c481bbeffdbf1aa3f8e5a30e8e354829680282c3fd74...[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mTrue[0m [36mworkload_geo_id_value[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-10-31T03:40:46.765375Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/metrics[0m [36mgeolocation_header_present[0m=[35mTrue[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mTrue[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:46.765933Z[0m [[32m[1minfo     [0m] [1mSecurityManager checking validation conditions for non-nonce request[0m [[34m[1m__main__[0m] [36mvalidate_geolocation[0m=[35mTrue[0m [36mvalidate_public_key_hash[0m=[35mTrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:46.766136Z[0m [[32m[1minfo     [0m] [1mSecurityManager calling validate_request_headers[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-10-31T03:40:46.766390Z[0m [[32m[1minfo     [0m] [1mGateway validate_request_headers called[0m [[34m[1m__main__[0m] [36mheaders_present[0m=[35m['Host', 'User-Agent', 'Accept-Encoding', 'Accept', 'Connection', 'Content-Type', 'Workload-Geo-Id', 'Signature-Input', 'Signature', 'Content-Length', 'Traceparent'][0m [36mvalidate_geolocation[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:46.766602Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] VALIDATE_SIGNATURE_METHOD_CALLED[0m [[34m[1m__main__[0m] [36mhas_signature[0m=[35mTrue[0m [36mhas_workload_geo_id[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35m2fcbb74343261c4f35c2f0c3b61dae3d3dadfc6bb233975f1c5b2fe60ec20b6a[0m
INFO:__main__:[2m2025-10-31T03:40:46.767171Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_VERIFICATION_ENTRY_POINT[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mvalidate_signature[0m=[35mTrue[0m [36mworkload_geo_id_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:46.767535Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_DEBUG_DATA_VERIFIED[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mdata_length[0m=[35m235[0m [36mdata_sha256[0m=[35m1644c707c28e275d...[0m [36mformat_match[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35m2fcbb74343261c4f35c2f0c3b61dae3d3dadfc6bb233975f1c5b2fe60ec20b6a[0m [36mworkload_geo_id_canonical[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mworkload_geo_id_original[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-10-31T03:40:46.767765Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Using shell script signature verification (same as collector)[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mdata_length[0m=[35m235[0m [36mpublic_key_hash[0m=[35m2fcbb74343261c4f35c2f0c3b61dae3d3dadfc6bb233975f1c5b2fe60ec20b6a[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-10-31T03:40:46.768702Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Running verification script[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mdata_length[0m=[35m235[0m [36mscript_path[0m=[35m/home/mw/AegisEdgeAI/zero-trust/tpm/verify_app_message_signature.sh[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-10-31T03:40:46.800875Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Shell script verification result[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mis_valid[0m=[35mFalse[0m [36mreturn_code[0m=[35m1[0m [36mstderr[0m=[35m801B0348CD7F0000:error:02000068:rsa routines:ossl_rsa_verify:bad signature:../crypto/rsa/rsa_sign.c:430:
801B0348CD7F0000:error:1C880004:Provider routines:rsa_verify:RSA lib:../providers/implementations/signature/rsa_sig.c:774:[0m [36mstdout[0m=[35m[INFO] Using hardware TPM via device:/dev/tpmrm0
[INFO] Hashing the message with SHA-256...
[INFO] Verifying signature with OpenSSL pkeyutl...
Signature Verification Failure[0m
WARNING:__main__:[2m2025-10-31T03:40:46.801492Z[0m [[33m[1mwarning  [0m] [1m‚ùå [GATEWAY] Workload-Geo-ID signature verification failed[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36malgorithm[0m=[35mRSA[0m [36mpublic_key_hash[0m=[35m2fcbb74343261c4f35c2f0c3b61dae3d3dadfc6bb233975f1c5b2fe60ec20b6a[0m [36msignature_length[0m=[35m256[0m
WARNING:__main__:[2m2025-10-31T03:40:46.801777Z[0m [[33m[1mwarning  [0m] [1mSecurityManager validation result[0m [[34m[1m__main__[0m] [36mvalidation_result[0m=[35m{'valid': False, 'reason': 'Workload-Geo-ID signature verification failed', 'details': {'agent_name': 'agent-001', 'public_key_hash': '2fcbb74343261c4f35c2f0c3b61dae3d3dadfc6bb233975f1c5b2fe60ec20b6a', 'validation_type': 'signature_validation', 'error_type': 'verification_failed'}}[0m
INFO:__main__:[2m2025-10-31T03:40:46.914215Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mNone[0m [36mSignature[0m=[35mNone[0m [36mSignature-Input[0m=[35mkeyid="d7f3277c8ed9852ce243abeff194267f778b7ccee9c7d05f0e89c691e4a7610a", created=1761882046, expires=1761882346, alg="RSA"[0m [36mWorkload-Geo-ID[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mmethod[0m=[35mGET[0m
INFO:__main__:[2m2025-10-31T03:40:46.914739Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mexpected_headers_for_endpoint[0m=[35mSignature-Input only (no geolocation)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/nonce[0m [36mquery_params[0m=[35m{'public_key_hash': 'd7f3277c8ed9852ce243abeff194267f778b7ccee9c7d05f0e89c691e4a7610a'}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="d7f3277c8ed9852ce243abeff194267f778b7ccee9c7d05f0e89c691e4a7610a", created=1761882046, expires=1761882346, alg="RSA"[0m [36msignature_present[0m=[35mFalse[0m [36msignature_value[0m=[35mNone[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mFalse[0m [36mworkload_geo_id_value[0m=[35mNone[0m
INFO:__main__:[2m2025-10-31T03:40:46.915236Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/nonce[0m [36mgeolocation_header_present[0m=[35mFalse[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mFalse[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:46.915689Z[0m [[32m[1minfo     [0m] [1mSecurityManager validating nonce request - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-10-31T03:40:46.915916Z[0m [[32m[1minfo     [0m] [1m‚úÖ [GATEWAY] Nonce validation passed - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-10-31T03:40:46.944143Z[0m [[32m[1minfo     [0m] [1mNonce request proxied successfully[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-10-31T03:40:47.739966Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mapplication/json[0m [36mSignature[0m=[35m7f975193c449a30539a5222b67587e0f6159360b8751a264d782ae23999052582898d4ebeb8f39136c3616617b0fa7c3cc7e1521728a6acc99135e20be9e272eaafe9389edfd0e5399785054e674a77224f4a61add64c363cdcc8e9ae2fc073afba2b52dc1566e5973c3c5182053707cd199fe820988374c28fb93f1cb13f3784af80a35617fc48a52d012c9692ea2ae9b10a9522f03ddc3352748fa2a7558cab269e25b1a34735c6f31f626e111026dd7e4db54267025fb4801df55e04ca6d499e97ed09471ef5954f27152af875cf84d87f658df7abc3a0ac2dcf9e7e2abcad4e6e60efcd70e492139f2f564924907fe6c40bc3a017956264ef19ba03cfc87[0m [36mSignature-Input[0m=[35mkeyid="d7f3277c8ed9852ce243abeff194267f778b7ccee9c7d05f0e89c691e4a7610a", created=1761882047, expires=1761882347, alg="RSA"[0m [36mWorkload-Geo-ID[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mendpoint[0m=[35m/metrics[0m [36mmethod[0m=[35mPOST[0m
INFO:__main__:[2m2025-10-31T03:40:47.740489Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mapplication/json[0m [36mendpoint[0m=[35m/metrics[0m [36mexpected_headers_for_endpoint[0m=[35mWorkload-Geo-ID + Signature-Input + Signature[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/metrics[0m [36mquery_params[0m=[35m{}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="d7f3277c8ed9852ce243abeff194267f778b7ccee9c7d05f0e89c691e4a7610a", created=1761882047, expires=1761882347, alg="RSA"[0m [36msignature_present[0m=[35mTrue[0m [36msignature_value[0m=[35m7f975193c449a30539a5222b67587e0f6159360b8751a264d782ae2399905258...[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mTrue[0m [36mworkload_geo_id_value[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-10-31T03:40:47.740991Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/metrics[0m [36mgeolocation_header_present[0m=[35mTrue[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mTrue[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:47.741563Z[0m [[32m[1minfo     [0m] [1mSecurityManager checking validation conditions for non-nonce request[0m [[34m[1m__main__[0m] [36mvalidate_geolocation[0m=[35mTrue[0m [36mvalidate_public_key_hash[0m=[35mTrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:47.741761Z[0m [[32m[1minfo     [0m] [1mSecurityManager calling validate_request_headers[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-10-31T03:40:47.742009Z[0m [[32m[1minfo     [0m] [1mGateway validate_request_headers called[0m [[34m[1m__main__[0m] [36mheaders_present[0m=[35m['Host', 'User-Agent', 'Accept-Encoding', 'Accept', 'Connection', 'Content-Type', 'Workload-Geo-Id', 'Signature-Input', 'Signature', 'Content-Length', 'Traceparent'][0m [36mvalidate_geolocation[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:47.742220Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] VALIDATE_SIGNATURE_METHOD_CALLED[0m [[34m[1m__main__[0m] [36mhas_signature[0m=[35mTrue[0m [36mhas_workload_geo_id[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35md7f3277c8ed9852ce243abeff194267f778b7ccee9c7d05f0e89c691e4a7610a[0m
INFO:__main__:[2m2025-10-31T03:40:47.742462Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_VERIFICATION_ENTRY_POINT[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mvalidate_signature[0m=[35mTrue[0m [36mworkload_geo_id_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:47.742765Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_DEBUG_DATA_VERIFIED[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mdata_length[0m=[35m248[0m [36mdata_sha256[0m=[35mc1ee6213cd03f7d8...[0m [36mformat_match[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35md7f3277c8ed9852ce243abeff194267f778b7ccee9c7d05f0e89c691e4a7610a[0m [36mworkload_geo_id_canonical[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mworkload_geo_id_original[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-10-31T03:40:47.743179Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Using shell script signature verification (same as collector)[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mdata_length[0m=[35m248[0m [36mpublic_key_hash[0m=[35md7f3277c8ed9852ce243abeff194267f778b7ccee9c7d05f0e89c691e4a7610a[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-10-31T03:40:47.744081Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Running verification script[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mdata_length[0m=[35m248[0m [36mscript_path[0m=[35m/home/mw/AegisEdgeAI/zero-trust/tpm/verify_app_message_signature.sh[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-10-31T03:40:47.776403Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Shell script verification result[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mis_valid[0m=[35mFalse[0m [36mreturn_code[0m=[35m1[0m [36mstderr[0m=[35m806B73E0BF7F0000:error:02000068:rsa routines:ossl_rsa_verify:bad signature:../crypto/rsa/rsa_sign.c:430:
806B73E0BF7F0000:error:1C880004:Provider routines:rsa_verify:RSA lib:../providers/implementations/signature/rsa_sig.c:774:[0m [36mstdout[0m=[35m[INFO] Using hardware TPM via device:/dev/tpmrm0
[INFO] Hashing the message with SHA-256...
[INFO] Verifying signature with OpenSSL pkeyutl...
Signature Verification Failure[0m
WARNING:__main__:[2m2025-10-31T03:40:47.776975Z[0m [[33m[1mwarning  [0m] [1m‚ùå [GATEWAY] Workload-Geo-ID signature verification failed[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36malgorithm[0m=[35mRSA[0m [36mpublic_key_hash[0m=[35md7f3277c8ed9852ce243abeff194267f778b7ccee9c7d05f0e89c691e4a7610a[0m [36msignature_length[0m=[35m256[0m
WARNING:__main__:[2m2025-10-31T03:40:47.777284Z[0m [[33m[1mwarning  [0m] [1mSecurityManager validation result[0m [[34m[1m__main__[0m] [36mvalidation_result[0m=[35m{'valid': False, 'reason': 'Workload-Geo-ID signature verification failed', 'details': {'agent_name': 'agent-geo-policy-violation-002', 'public_key_hash': 'd7f3277c8ed9852ce243abeff194267f778b7ccee9c7d05f0e89c691e4a7610a', 'validation_type': 'signature_validation', 'error_type': 'verification_failed'}}[0m
INFO:__main__:[2m2025-10-31T03:40:47.884784Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mNone[0m [36mSignature[0m=[35mNone[0m [36mSignature-Input[0m=[35mkeyid="a7ae19ca3816cf3ae0817ebc7e18a66783989a4749140bb47cc96210ab7aa611", created=1761882047, expires=1761882347, alg="RSA"[0m [36mWorkload-Geo-ID[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mmethod[0m=[35mGET[0m
INFO:__main__:[2m2025-10-31T03:40:47.885316Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mexpected_headers_for_endpoint[0m=[35mSignature-Input only (no geolocation)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/nonce[0m [36mquery_params[0m=[35m{'public_key_hash': 'a7ae19ca3816cf3ae0817ebc7e18a66783989a4749140bb47cc96210ab7aa611'}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="a7ae19ca3816cf3ae0817ebc7e18a66783989a4749140bb47cc96210ab7aa611", created=1761882047, expires=1761882347, alg="RSA"[0m [36msignature_present[0m=[35mFalse[0m [36msignature_value[0m=[35mNone[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mFalse[0m [36mworkload_geo_id_value[0m=[35mNone[0m
INFO:__main__:[2m2025-10-31T03:40:47.885817Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/nonce[0m [36mgeolocation_header_present[0m=[35mFalse[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mFalse[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-10-31T03:40:47.886271Z[0m [[32m[1minfo     [0m] [1mSecurityManager validating nonce request - public key hash only[0m [[34m[1m__main__[0m] 
WARNING:__main__:[2m2025-10-31T03:40:47.886504Z[0m [[33m[1mwarning  [0m] [1m‚ùå [GATEWAY] Nonce request from unauthorized agent[0m [[34m[1m__main__[0m] [36magent_public_key_hash[0m=[35ma7ae19ca3816cf3a...[0m [36mrequest_ip[0m=[35m127.0.0.1[0m
